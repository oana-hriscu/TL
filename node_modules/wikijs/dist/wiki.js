'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.default=wiki;var _util=require('./util'),_page=require('./page'),_page2=_interopRequireDefault(_page);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var defaultOptions={apiUrl:'http://en.wikipedia.org/w/api.php',origin:'*'};function wiki(){function a(o){return o.query.redirects&&1===o.query.redirects.length?(0,_util.api)(n,{prop:'info|pageprops',inprop:'url',ppprop:'disambiguation',titles:o.query.redirects[0].to}):o}function b(o){var p=1<arguments.length&&arguments[1]!==void 0?arguments[1]:50;return(0,_util.pagination)(n,{list:'search',srsearch:o,srlimit:p},function(q){return q.query.search.map(function(r){return r.title})}).catch(function(q){if('"text" search is disabled.'===q.message)return d(o,p);throw q})}function d(o){var p=1<arguments.length&&arguments[1]!==void 0?arguments[1]:50;return(0,_util.api)(n,{search:o,limit:p,namespace:0,action:'opensearch',redirects:void 0}).then(function(q){return q[1]})}function f(o){return(0,_util.api)(n,{prop:'info|pageprops',inprop:'url',ppprop:'disambiguation',titles:o}).then(a).then(function(p){var q=Object.keys(p.query.pages)[0];if(!q||'-1'===q)throw new Error('No article found');return(0,_page2.default)(p.query.pages[q],n)})}var m=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};this instanceof wiki&&console.log('Please do not use wikijs ^1.0.0 as a class. Please see the new README.');var n=Object.assign({},defaultOptions,m);return{search:b,random:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return(0,_util.api)(n,{list:'random',rnnamespace:0,rnlimit:o}).then(function(p){return p.query.random.map(function(q){return q.title})})},page:f,geoSearch:function(o,p){var q=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1e3;return(0,_util.api)(n,{list:'geosearch',gsradius:q,gscoord:o+'|'+p}).then(function(r){return r.query.geosearch.map(function(s){return s.title})})},options:m,findById:function(o){return(0,_util.api)(n,{prop:'info|pageprops',inprop:'url',ppprop:'disambiguation',pageids:o}).then(a).then(function(p){var q=Object.keys(p.query.pages)[0];if(!q||'-1'===q)throw new Error('No article found');return(0,_page2.default)(p.query.pages[q],n)})},find:function(o){var p=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(q){return q[0]};return b(o).then(function(q){return p(q.results)}).then(function(q){return f(q)})},allPages:function(){return(0,_util.aggregate)(n,{},'allpages','title','ap')},allCategories:function(){return(0,_util.aggregate)(n,{},'allcategories','*','ac')},pagesInCategory:function(o){return(0,_util.aggregate)(n,{cmtitle:o},'categorymembers','title','cm')},opensearch:d,prefixSearch:function(o){var p=1<arguments.length&&arguments[1]!==void 0?arguments[1]:50;return(0,_util.pagination)(n,{list:'prefixsearch',pslimit:p,psprofile:'fuzzy',pssearch:o},function(q){return q.query.prefixsearch.map(function(r){return r.title})})}}}
//# sourceMappingURL=wiki.js.map